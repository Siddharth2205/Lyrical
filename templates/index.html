<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lyrical — Transliterate Any Song</title>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:ital,wght@0,300;0,400;0,500;1,300&display=swap" rel="stylesheet"/>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #0a0a0f;
      --surface: #111118;
      --card: #16161f;
      --border: #2a2a3a;
      --accent: #e8ff47;
      --accent2: #ff6b6b;
      --text: #f0f0f5;
      --muted: #6b6b80;
      --font-display: 'Bebas Neue', sans-serif;
      --font-body: 'DM Sans', sans-serif;
    }

    html { scroll-behavior: smooth; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: var(--font-body);
      font-weight: 300;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Noise texture overlay */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
      pointer-events: none;
      z-index: 999;
      opacity: 0.4;
    }

    /* Header */
    header {
      padding: 2rem 3rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      background: rgba(10,10,15,0.85);
      backdrop-filter: blur(12px);
      z-index: 100;
    }

    .logo {
      font-family: var(--font-display);
      font-size: 2rem;
      letter-spacing: 0.05em;
      color: var(--accent);
    }

    .logo span {
      color: var(--text);
    }

    .tagline {
      font-size: 0.75rem;
      color: var(--muted);
      letter-spacing: 0.2em;
      text-transform: uppercase;
    }

    /* Main layout */
    main {
      max-width: 1100px;
      margin: 0 auto;
      padding: 3rem 2rem 6rem;
    }

    /* Hero */
    .hero {
      text-align: center;
      padding: 4rem 0 3rem;
      animation: fadeUp 0.6s ease both;
    }

    .hero h1 {
      font-family: var(--font-display);
      font-size: clamp(3.5rem, 10vw, 7rem);
      line-height: 0.95;
      letter-spacing: 0.02em;
      margin-bottom: 1rem;
    }

    .hero h1 em {
      font-style: normal;
      color: var(--accent);
      -webkit-text-stroke: 0px;
    }

    .hero p {
      color: var(--muted);
      font-size: 1rem;
      letter-spacing: 0.05em;
      max-width: 400px;
      margin: 0 auto;
    }

    /* Search */
    .search-wrap {
      position: relative;
      max-width: 600px;
      margin: 3rem auto 0;
      animation: fadeUp 0.6s 0.1s ease both;
    }

    .search-wrap input {
      width: 100%;
      background: var(--card);
      border: 1px solid var(--border);
      color: var(--text);
      font-family: var(--font-body);
      font-size: 1rem;
      font-weight: 400;
      padding: 1rem 3rem 1rem 1.5rem;
      border-radius: 4px;
      outline: none;
      transition: border-color 0.2s;
    }

    .search-wrap input::placeholder { color: var(--muted); }

    .search-wrap input:focus { border-color: var(--accent); }

    /* Spinner */
    .search-spinner {
      position: absolute;
      right: 1rem;
      top: 50%;
      transform: translateY(-50%);
      width: 16px;
      height: 16px;
      border: 2px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      display: none;
      animation: spin 0.6s linear infinite;
    }

    @keyframes spin { to { transform: translateY(-50%) rotate(360deg); } }

    /* Search results */
    #search-results {
      max-width: 600px;
      margin: 0.5rem auto 0;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 4px;
      overflow: hidden;
      display: none;
    }

    .track-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.8rem 1.2rem;
      cursor: pointer;
      transition: background 0.15s;
      border-bottom: 1px solid var(--border);
      animation: fadeIn 0.2s ease both;
    }

    .track-item:last-child { border-bottom: none; }

    .track-item:hover { background: rgba(232,255,71,0.05); }

    .track-item img {
      width: 44px;
      height: 44px;
      border-radius: 2px;
      object-fit: cover;
      flex-shrink: 0;
    }

    .track-info { flex: 1; min-width: 0; }

    .track-name {
      font-weight: 500;
      font-size: 0.9rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .track-artist {
      font-size: 0.78rem;
      color: var(--muted);
      margin-top: 2px;
    }

    .track-select-btn {
      font-family: var(--font-display);
      font-size: 0.85rem;
      letter-spacing: 0.08em;
      color: var(--accent);
      background: none;
      border: 1px solid var(--accent);
      padding: 0.3rem 0.7rem;
      border-radius: 2px;
      cursor: pointer;
      transition: all 0.15s;
      flex-shrink: 0;
    }

    .track-select-btn:hover {
      background: var(--accent);
      color: #0a0a0f;
    }

    /* Loading */
    #loading {
      display: none;
      text-align: center;
      padding: 4rem 0;
    }

    .loading-bars {
      display: flex;
      justify-content: center;
      align-items: flex-end;
      gap: 5px;
      height: 40px;
      margin-bottom: 1rem;
    }

    .loading-bars span {
      display: block;
      width: 5px;
      background: var(--accent);
      border-radius: 2px;
      animation: bar 0.8s ease-in-out infinite alternate;
    }

    .loading-bars span:nth-child(1) { height: 20px; animation-delay: 0s; }
    .loading-bars span:nth-child(2) { height: 35px; animation-delay: 0.1s; }
    .loading-bars span:nth-child(3) { height: 25px; animation-delay: 0.2s; }
    .loading-bars span:nth-child(4) { height: 40px; animation-delay: 0.3s; }
    .loading-bars span:nth-child(5) { height: 15px; animation-delay: 0.4s; }
    .loading-bars span:nth-child(6) { height: 30px; animation-delay: 0.2s; }
    .loading-bars span:nth-child(7) { height: 22px; animation-delay: 0.1s; }

    @keyframes bar {
      from { transform: scaleY(0.3); opacity: 0.4; }
      to { transform: scaleY(1); opacity: 1; }
    }

    #loading p { color: var(--muted); font-size: 0.85rem; letter-spacing: 0.1em; text-transform: uppercase; }

    /* Results */
    #result {
      display: none;
      animation: fadeUp 0.5s ease both;
      margin-top: 3rem;
    }

    .song-header {
      display: flex;
      align-items: center;
      gap: 1.5rem;
      margin-bottom: 2.5rem;
      padding-bottom: 2rem;
      border-bottom: 1px solid var(--border);
    }

    .song-header img {
      width: 80px;
      height: 80px;
      border-radius: 4px;
      object-fit: cover;
    }

    .song-title {
      font-family: var(--font-display);
      font-size: 2.5rem;
      letter-spacing: 0.03em;
      line-height: 1;
    }

    .song-artist {
      color: var(--muted);
      font-size: 0.9rem;
      margin-top: 0.4rem;
      letter-spacing: 0.05em;
    }

    /* Toggle tabs */
    .view-tabs {
      display: flex;
      gap: 0;
      margin-bottom: 1.5rem;
      border: 1px solid var(--border);
      border-radius: 4px;
      overflow: hidden;
      width: fit-content;
    }

    .tab-btn {
      font-family: var(--font-display);
      font-size: 0.9rem;
      letter-spacing: 0.1em;
      padding: 0.6rem 1.5rem;
      background: none;
      color: var(--muted);
      border: none;
      cursor: pointer;
      transition: all 0.15s;
    }

    .tab-btn.active {
      background: var(--accent);
      color: #0a0a0f;
    }

    .tab-btn:not(.active):hover {
      background: rgba(255,255,255,0.05);
      color: var(--text);
    }

    /* Lyrics panels */
    .lyrics-panels {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
    }

    .lyrics-panels.single { grid-template-columns: 1fr; }

    .lyrics-panel {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 1.5rem 2rem;
      max-height: 600px;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: var(--border) transparent;
    }

    .lyrics-panel::-webkit-scrollbar { width: 4px; }
    .lyrics-panel::-webkit-scrollbar-track { background: transparent; }
    .lyrics-panel::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

    .panel-label {
      font-size: 0.7rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--accent);
      margin-bottom: 1.5rem;
      font-weight: 500;
    }

    .lyrics-text {
      font-size: 0.95rem;
      line-height: 2;
      color: var(--text);
      white-space: pre-wrap;
      font-weight: 300;
    }

    .lyrics-text .section-header {
      color: var(--muted);
      font-size: 0.78rem;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      display: block;
      margin: 1rem 0 0.3rem;
    }

    /* Error */
    #error {
      display: none;
      text-align: center;
      padding: 3rem;
      color: var(--accent2);
    }

    #error p { font-size: 0.9rem; margin-top: 0.5rem; color: var(--muted); }

    /* Footer */
    footer {
      text-align: center;
      padding: 2rem;
      color: var(--muted);
      font-size: 0.75rem;
      letter-spacing: 0.1em;
      border-top: 1px solid var(--border);
      text-transform: uppercase;
    }

    /* Animations */
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* Responsive */
    @media (max-width: 680px) {
      header { padding: 1.2rem 1.5rem; }
      main { padding: 2rem 1.2rem 4rem; }
      .lyrics-panels { grid-template-columns: 1fr; }
      .song-header img { width: 60px; height: 60px; }
      .song-title { font-size: 1.8rem; }
    }
  </style>
</head>
<body>

<header>
  <div class="logo">LYRI<span>XA</span></div>
  <div class="tagline">Sing in any language</div>
</header>

<main>
  <div class="hero">
    <h1>SING <em>EVERY</em><br>SONG</h1>
    <p>Search any track and get instant phonetic transliteration for any language.</p>
  </div>

  <div class="search-wrap">
    <input type="text" id="search-input" placeholder="Search for a song or artist..." autocomplete="off"/>
    <div class="search-spinner" id="search-spinner"></div>
  </div>

  <div id="search-results"></div>

  <div id="loading">
    <div class="loading-bars">
      <span></span><span></span><span></span><span></span>
      <span></span><span></span><span></span>
    </div>
    <p>Transliterating lyrics...</p>
  </div>

  <div id="error">
    <div style="font-family: var(--font-display); font-size: 2rem;">OOPS</div>
    <p id="error-msg">Something went wrong. Please try again.</p>
  </div>

  <div id="result">
    <div class="song-header">
      <img id="album-art" src="" alt="Album art"/>
      <div>
        <div class="song-title" id="song-title"></div>
        <div class="song-artist" id="song-artist"></div>
      </div>
    </div>

    <div class="view-tabs">
      <button class="tab-btn active" onclick="setView('both')">SIDE BY SIDE</button>
      <button class="tab-btn" onclick="setView('original')">ORIGINAL</button>
      <button class="tab-btn" onclick="setView('transliterated')">TRANSLITERATED</button>
    </div>

    <div class="lyrics-panels" id="lyrics-panels">
      <div class="lyrics-panel">
        <div class="panel-label">Original</div>
        <div class="lyrics-text" id="original-lyrics"></div>
      </div>
      <div class="lyrics-panel">
        <div class="panel-label">Transliterated</div>
        <div class="lyrics-text" id="transliterated-lyrics"></div>
      </div>
    </div>
  </div>
</main>

<footer>Lyrixa &mdash; Powered by Groq &amp; Genius &mdash; 2025</footer>

<script>
  let currentView = 'both';
  let debounceTimer = null;
  let lastQuery = '';

  const searchInput = document.getElementById('search-input');
  const resultsEl  = document.getElementById('search-results');
  const spinner    = document.getElementById('search-spinner');

  // ── Live search: debounce 300ms ──────────────────────────────────────────
  searchInput.addEventListener('input', () => {
    const q = searchInput.value.trim();

    // Clear dropdown if input is empty
    if (!q) {
      closeResults();
      return;
    }

    // Don't re-fetch same query
    if (q === lastQuery) return;

    clearTimeout(debounceTimer);
    debounceTimer = setTimeout(() => fetchSuggestions(q), 300);
  });

  // Close dropdown on Escape
  searchInput.addEventListener('keydown', e => {
    if (e.key === 'Escape') closeResults();
  });

  // Close dropdown when clicking outside
  document.addEventListener('click', e => {
    if (!e.target.closest('.search-wrap') && !e.target.closest('#search-results')) {
      closeResults();
    }
  });

  // Re-open dropdown on focus if there's a query
  searchInput.addEventListener('focus', () => {
    if (searchInput.value.trim() && resultsEl.children.length) {
      resultsEl.style.display = 'block';
    }
  });

  async function fetchSuggestions(q) {
    lastQuery = q;
    spinner.style.display = 'block';
    resultsEl.style.display = 'block';
    resultsEl.innerHTML = `
      <div class="track-item">
        <div class="track-info">
          <div class="track-name" style="color:var(--muted)">Searching...</div>
        </div>
      </div>`;

    try {
      const res = await fetch(`/search?q=${encodeURIComponent(q)}`);
      const tracks = await res.json();

      // Abort if the input changed while we were fetching
      if (searchInput.value.trim() !== q) return;

      spinner.style.display = 'none';

      if (!tracks.length || tracks.error) {
        resultsEl.innerHTML = `
          <div class="track-item">
            <div class="track-info">
              <div class="track-name" style="color:var(--muted)">No results for "${escapeHtml(q)}"</div>
            </div>
          </div>`;
        return;
      }

      resultsEl.innerHTML = tracks.map(t => `
        <div class="track-item" onclick="selectTrack('${t.id}')">
          ${t.album_art
            ? `<img src="${t.album_art}" alt="art"/>`
            : `<div style="width:44px;height:44px;background:var(--border);border-radius:2px;flex-shrink:0"></div>`}
          <div class="track-info">
            <div class="track-name">${escapeHtml(t.name)}</div>
            <div class="track-artist">${escapeHtml(t.artist)}</div>
          </div>
          <button class="track-select-btn">SELECT</button>
        </div>
      `).join('');

    } catch {
      spinner.style.display = 'none';
      resultsEl.innerHTML = `
        <div class="track-item">
          <div class="track-info">
            <div class="track-name" style="color:var(--accent2)">Error fetching results.</div>
          </div>
        </div>`;
    }
  }

  function closeResults() {
    resultsEl.style.display = 'none';
    spinner.style.display = 'none';
  }

  // ── Select a track ────────────────────────────────────────────────────────
  async function selectTrack(trackId) {
    closeResults();
    searchInput.blur();

    hide('result'); hide('error');
    show('loading');

    try {
      const res = await fetch('/transliterate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ track_id: trackId })
      });

      const data = await res.json();

      if (!res.ok || data.error) {
        showError(data.error || 'Failed to fetch lyrics.');
        return;
      }

      document.getElementById('album-art').src = data.album_art || '';
      document.getElementById('album-art').style.display = data.album_art ? 'block' : 'none';
      document.getElementById('song-title').textContent = data.title;
      document.getElementById('song-artist').textContent = data.artist;
      document.getElementById('original-lyrics').innerHTML = formatLyrics(data.original);
      document.getElementById('transliterated-lyrics').innerHTML = formatLyrics(data.transliterated);

      // Update input to show selected track name
      searchInput.value = `${data.title} — ${data.artist}`;
      lastQuery = '';

      hide('loading');
      setView('both');
      show('result');
      document.getElementById('result').scrollIntoView({ behavior: 'smooth', block: 'start' });

    } catch {
      showError('Network error. Is the server running?');
    }
  }

  // ── Helpers ───────────────────────────────────────────────────────────────
  function escapeHtml(str) {
    return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
  }

  function formatLyrics(text) {
    return escapeHtml(text)
      .replace(/\[([^\]]+)\]/g, '<span class="section-header">[$1]</span>');
  }

  function setView(mode) {
    currentView = mode;
    const panels = document.getElementById('lyrics-panels');
    const originalPanel = panels.children[0];
    const transliteratedPanel = panels.children[1];

    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.tab-btn')[['both','original','transliterated'].indexOf(mode)].classList.add('active');

    if (mode === 'both') {
      panels.classList.remove('single');
      originalPanel.style.display = 'block';
      transliteratedPanel.style.display = 'block';
    } else if (mode === 'original') {
      panels.classList.add('single');
      originalPanel.style.display = 'block';
      transliteratedPanel.style.display = 'none';
    } else {
      panels.classList.add('single');
      originalPanel.style.display = 'none';
      transliteratedPanel.style.display = 'block';
    }
  }

  function showError(msg) {
    hide('loading'); hide('result');
    document.getElementById('error-msg').textContent = msg;
    show('error');
  }

  function show(id) { document.getElementById(id).style.display = 'block'; }
  function hide(id) { document.getElementById(id).style.display = 'none'; }
</script>

</body>
</html>